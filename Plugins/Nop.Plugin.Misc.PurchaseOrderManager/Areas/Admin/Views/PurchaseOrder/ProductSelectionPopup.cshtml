@model AddSupplierProductSearchModel
@using Nop.Web.Framework.Extensions
@using Nop.Web.Framework.Models.DataTables
@using Microsoft.AspNetCore.Routing

@{
	Layout = "_AdminPopupLayout";

	// page title
	ViewBag.PageTitle = T("Admin.Catalog.Products.RelatedProducts.AddNew").Text;
}

@if (ViewBag.RefreshPage == true)
{
	<script>
		try { window.opener.document.forms['@(Context.Request.Query["formId"])'].@(Context.Request.Query["btnId"]).click(); }
		catch (e) {}
		window.close();
	</script>
}
else
{
	<form asp-controller="PurchaseOrderManager" asp-action="Create"
		  asp-route-supplierId="@Context.Request.Query["supplierId"]"
		  asp-route-btnId="@Context.Request.Query["btnId"]"
		  asp-route-formId="@Context.Request.Query["formId"]">
		<input type="hidden" asp-for="SupplierId" />

		<div class="content-header clearfix">
			<h1 class="float-left">@T("Admin.Catalog.Products.RelatedProducts.AddNew")</h1>
			<div class="float-right">&nbsp;</div>
		</div>

		<section class="content">
			<div class="container-fluid">
				<div class="form-horizontal">
					<div class="cards-group">

						<!-- Search Card -->
						<div class="card card-default card-search card-popup">
							<div class="card-body">
								<div class="row">
									<div class="col-sm-6">
										<div class="form-group row">
											<div class="col-sm-5">
												<nop-label asp-for="SearchProductName" />
											</div>
											<div class="col-sm-7">
												<nop-editor asp-for="SearchProductName" />
											</div>
										</div>
									</div>
								</div>

								<div class="row">
									<div class="col-sm-12">
										<button type="button" id="search-products" class="btn btn-primary btn-search">
											<i class="fas fa-magnifying-glass"></i>
											@T("Admin.Common.Search")
										</button>
									</div>
								</div>
							</div>
						</div>

						<!-- Table Card -->
						<div class="card card-default">
							<div class="card-body">
								@await Html.PartialAsync("Table", new DataTablesModel
								{
									Name = "products-grid",
									UrlRead = new DataUrl("SupplierProductAddPopupList", "PurchaseOrderManager", new RouteValueDictionary { { "supplierId", Model.SupplierId } }),
									SearchButtonId = "search-products",
									Length = Model.PageSize,
									LengthMenu = Model.AvailablePageSizes,
									Filters = new List<FilterParameter>
									{
										new FilterParameter(nameof(Model.SearchProductName))
									},
									ColumnCollection = new List<ColumnProperty>
									{
										new ColumnProperty(nameof(PurchaseOrderProductModel.ProductId))
										{
											IsMasterCheckBox = true,
											Render = new RenderCheckBox("SelectedProductIds"),
											ClassName = NopColumnClassDefaults.CenterAll,
											Width = "50"
										},
										new ColumnProperty(nameof(PurchaseOrderProductModel.ProductName))
										{
											Title = T("Admin.Catalog.Products.Fields.Name").Text
										},
										new ColumnProperty(nameof(PurchaseOrderProductModel.Published))
										{
											Title = T("Admin.Catalog.Products.Fields.Published").Text,
											Width = "100",
											ClassName = NopColumnClassDefaults.CenterAll,
											Render = new RenderBoolean()
										}
									}
								})
							</div>

							<div class="card-footer">
								<button type="submit" name="save" class="btn btn-primary">
									<i class="far fa-floppy-disk"></i>
									@T("Admin.Common.Save")
								</button>
							</div>
						</div>

					</div>
				</div>
			</div>
		</section>
	</form>
}

@NopHtml.GenerateInlineScripts(ResourceLocation.Footer)
